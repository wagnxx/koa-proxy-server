(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c9a1c4e"],{"1a78":function(t,e,i){"use strict";i("63ab")},"1caf":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i("7dfc");async function s(t,e,i){const{fileType:s,blobType:l="application/ms-excel"}=i,o=await t(e);if("application/json"===o.type){const t=new FileReader;t.readAsText(o);const e=this;t.onload=function(){const i=JSON.parse(t.result);e.$modal.msgError(i.header.responseDesc)}}else{const t=new Date,e=Object(a["a"])(t,"YYYYMMDDHHmmss");let i="FINANCIAL_RECONCILIATION_"+e+"."+s.toLowerCase();o.headers&&(i=o.headers["content-disposition"].split(";")[1].split("filename=")[1]);const n=new Blob([o],{type:l}),r=document.createElement("a");r.download=i,r.style.display="none",r.href=URL.createObjectURL(n),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)}}},"516e":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"role-config business-portal-page",class:{"has-split-line":t.isShowLine}},[e("div",{staticStyle:{"margin-bottom":"20px"}},[e("portal-header",{attrs:{projectObj:t.titleConfig,showBottomLine:!1}}),e("portal-form",{ref:"searchList",attrs:{"form-data":t.searchList,"form-config-list":t.formConfigList,searchBtnLoading:t.searchLoading},on:{"common-enter-event":t.search,"reset-btn-click":t.reset,"search-btn-click":t.search}}),e("div",{staticClass:"table-list-container"},[e("div",{staticStyle:{"padding-bottom":"16px"}},[e("el-dropdown",{on:{command:t.exportData}},[e("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary",size:"small",disabled:t.isExport||!t.hasPerm("IC_ORG_OPR_AUDITLOG_EXPORT_BTN")}},[t._v(" "+t._s(t.$t("common.button.export"))+" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{"font-size":"12px"}})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"XLS"}},[t._v("Excel")]),e("el-dropdown-item",{attrs:{command:"XLSX"}},[t._v("Excel 2007")]),e("el-dropdown-item",{attrs:{command:"CSV"}},[t._v("CSV")]),e("el-dropdown-item",{attrs:{command:"PDF"}},[t._v("PDF")]),e("el-dropdown-item",{attrs:{command:"TXT"}},[t._v("TXT")])],1)],1)],1),e("table-page",{staticClass:"table-page",attrs:{size:"small","has-pagination":t.hasPage,columns:t.columns,pagination:t.paginationConfig,getTableData:t.getTableData,"is-search":t.refreshTableFlag,sortArr:t.sortArr,initializingLoading:!1},scopedSlots:t._u([{key:"logTime",fn:function(e){return[t._v(" "+t._s(t._f("dateformat")(e.data.row.logTime,"DD-MM-YYYY HH:mm:ss"))+" ")]}},{key:"operation",fn:function(i){return[e("el-button",{staticClass:"btn",attrs:{type:"text",disabled:!t.hasPerm("IC_ORG_OPR_AUDITLOG_VIEW_BTN")},on:{click:function(e){return t.handleDetail(i.data.row)}}},[t._v(" "+t._s(t.$t("common.label.detail"))+" ")])]}}])}),e("DetailDialog",{ref:"viewDetail"})],1)],1)])},s=[],l=i("4c09"),o=i("3186"),n=i("c811"),r=i("fb94"),h=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"dialog-container",attrs:{title:t.$t("IDC.till.viewDetails"),visible:t.isShow,width:"560px","close-on-click-modal":!1,labelClassName:"till-view-detail"},on:{close:function(e){return t.closeDialog()}}},[e("div",t._l(t.detailsData,(function(i,a){return e("el-descriptions",{key:a,attrs:{column:1}},[i.hidden?t._e():e("el-descriptions-item",{attrs:{label:i.label}},[e("descriptions-tooltip",{attrs:{isJump:i.isJump||!1,value:t._f("formatEmpty")(i.value)}})],1)],1)})),1),e("div",{staticClass:"take-call-list"},[t.labelData.list?e("el-table",{attrs:{data:t.labelData.list,"header-cell-class-name":"table-header-class","cell-class-name":"table-cell-class"}},[e("el-table-column",{attrs:{property:"initiatorType",label:"initiatorType","show-overflow-tooltip":"",width:"90"}}),e("el-table-column",{attrs:{property:"initiatorId",label:"initiatorId","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{property:"time",label:"time","show-overflow-tooltip":"",width:"70"}}),e("el-table-column",{attrs:{property:"event",label:"event","show-overflow-tooltip":""}})],1):t._e()],1)])},d=[],c=function(){var t=this,e=t._self._c;return e("el-tooltip",{attrs:{content:t.value,disabled:t.tooltipShow,placement:"top-start","visible-arrow":!1}},[t.isJump?e("el-link",{ref:"content",attrs:{type:"primary"},on:{mouseover:t.isShowTooltip,click:function(e){return t.goDetails(t.value)}}},[t._v(" "+t._s(t.value)+" ")]):e("span",{ref:"content",on:{mouseover:t.isShowTooltip}},[t._v(t._s(t.value))])],1)},p=[],m={name:"DescriptionsTooltip",props:{value:{type:String,default:""},isJump:{type:Boolean,default:!1}},data(){return{tooltipShow:!1}},methods:{isShowTooltip(){const t=this.$refs.content.offsetWidth<this.$refs.content.parentNode.offsetWidth;this.tooltipShow=t},goDetails(t){let e={bulkPlanID:t,mode:"taskPlan",type:"details"};this.openNewWindow({path:"/mainPage/identifierCenter/organizationInfo/till/bulkDetails",query:{params:encodeURIComponent(JSON.stringify(e))}})}}},u=m,g=i("2877"),y=Object(g["a"])(u,c,p,!1,null,"1879110e",null),f=y.exports,b={name:"detailDialog",components:{DescriptionsTooltip:f},props:{},data(){return{isShow:!1,labelData:{},type:"",initiatorType:""}},computed:{detailsData(){return[{label:this.$t("IDC.till.masterType"),key:"masterType",value:""},{label:this.$t("IDC.till.masterID"),key:"masterId",value:""},{hidden:!1,label:this.$t("IDC.till.Initiator"),key:"initiatorInfo",value:""},{hidden:!1,label:this.$t("IDC.till.times"),key:"logTime",value:""},{hidden:!1,label:this.$t("IDC.till.event"),key:"event",value:""},{hidden:this.isShowTakItem("IDENTITY"),label:this.$t("IDC.till.beforeImage"),key:"beforeImage",value:""},{hidden:this.isShowTakItem("IDENTITY"),label:this.$t("IDC.till.afterImage"),key:"afterImage",value:""},{hidden:!1,label:this.$t("IDC.till.startTime"),key:"startTime",value:""},{hidden:!1,label:this.$t("IDC.till.endTime"),key:"endTime",value:""},{isJump:!0,hidden:this.isShowTakItem(),label:this.$t("IDC.till.taskID"),key:"taskId",value:""},{hidden:this.isShowTakItem(),label:this.$t("IDC.till.taskType"),key:"taskType",value:""},{hidden:this.isShowTakItem(),label:this.$t("IDC.till.taskCategory"),key:"taskCategory",value:""},{hidden:this.isShowTakItem(),label:this.$t("IDC.till.workflowID"),key:"relatedWorkflowId",value:""},{hidden:this.isTaskHidden(),label:this.$t("IDC.till.searchCriteria"),key:"searchCriteria",value:""},{hidden:this.isShowItem(),label:this.$t("IDC.till.hasBeenDownloaded"),key:"hasBeenDownloaded",value:""},{hidden:this.isShowItem(),label:this.$t("IDC.till.isSensitive"),key:"isSensitive",value:""},{hidden:this.isShowItem(),label:this.$t("IDC.till.infoType"),key:"infoType",value:""},{hidden:!1,label:this.$t("IDC.till.reason"),key:"reason",value:""},{hidden:this.isTaskHidden(),label:this.$t("IDC.till.errorCode"),key:"errorCode",value:""},{hidden:this.isTaskHidden(),label:this.$t("IDC.till.errorMessage"),key:"errorMsg",value:""},{hidden:!1,label:this.$t("IDC.till.clientIP"),key:"fromIp",value:""},{hidden:!1,label:this.$t("IDC.till.eventResult"),key:"eventResult",value:""}]}},methods:{isShowItem(){switch(this.type){case"QUERY":return!1;default:return!0}},isTaskHidden(){return"TASK"===this.type},isShowTakItem(t){return"TASK"!==this.type&&"IDENTITY"!==t},showDetail(t){this.labelData=t,this.initiatorType=t.initiatorType,this.type=t.type,this.isShow=!0,this.formatDta()},formatDta(){let t=this.labelData;for(var e in t)this.detailsData.forEach((i,a)=>{i.key===e&&(this.detailsData[a].value=t[e].toString())})},closeDialog(){this.isShow=!1;for(let t=0;t<this.detailsData.length;t++)this.detailsData[t].value=""},dataType(t){return"boolean"===typeof t?t.toString():"-"}}},v=b,D=(i("cf2e"),Object(g["a"])(v,h,d,!1,null,"1458f88b",null)),I=D.exports,T=i("5a0c"),L=i.n(T),w=i("7dfc"),C=i("1caf"),k={components:{TablePage:l["a"],PortalForm:o["a"],PortalHeader:n["a"],DetailDialog:I},name:"AuditLog",props:{identityId:{type:String,default:""},initiatorType:{type:String,default:"Organization Operator"},title:{type:Object,default:()=>{}},hasSplitline:{type:Boolean,default:!1}},data(){return{isShowLine:!1,isExport:!0,hasPage:!1,searchLoading:!1,refreshTableFlag:!1,paginationConfig:{total:0,pageIndex:1,pageSize:10},titleConfig:{title:this.$t("IDC.auditlog.AuditLogTitle"),desc:this.$t("IDC.auditlog.desc")},searchList:{type:"",event:"",eventGroup:"",identityId:"",initiatorId:"",initiatorType:"",startTime:"",endTime:"",time:[]},categoryList:[],eventList:[{label:"All",value:""}],eventGroupList:[{label:"All",value:""}],columns:[{label:this.$t("IDC.till.initiatorType")},{label:this.$t("IDC.till.initiator")},{label:this.$t("IDC.till.times")},{label:this.$t("IDC.till.event")},{label:this.$t("IDC.auditlog.operation"),prop:"operation",align:"left",__slotName:"operation",width:"100"}],direction:"rtl",choiceDate:"",limitDays:{},pickerOptions:{onPick:({maxDate:t,minDate:e})=>{e&&!t&&(this.choiceDate=e.getTime()),t&&(this.choiceDate="")},disabledDate:t=>{let e=new Date(Object(w["a"])((new Date).getTime(),"YYYY-MM-DD")+" 23:59:59").getTime();if(this.isNull(this.choiceDate))return t.getTime()>e;{const i=24*this.limitDays.maxDay*3600*1e3;let a=this.choiceDate+i-1;a=a>e?e:a;const s=this.choiceDate-i+1;return t.getTime()<s||t.getTime()>a}}},sortArr:[],isReset:!1,isHome:!1,initiatorId:""}},created(){this.getLimitDay(),this.getCategoryList();let t=["Organization","Customer","Till","Group"];if(t.includes(this.initiatorType))this.searchList.identityId=this.identityId;else{let t=JSON.parse(decodeURIComponent(this.$route.query.data));t.type?(this.initiatorId=t.initiatorId,this.searchList.initiatorId=t.initiatorId,this.isHome=!0):this.searchList.identityId=JSON.parse(decodeURIComponent(this.$route.query.data)).orgOperatorId,t.orgOperatorId&&(this.isShowLine=!0),t.title&&(this.titleConfig=t.title),t.hasSplitline&&(this.isShowLine=t.hasSplitline)}this.title&&(this.titleConfig=this.title),this.hasSplitline&&(this.isShowLine=this.hasSplitline)},watch:{initiatorId(){this.searchList.initiatorId=this.initiatorId},"searchList.type":{handler(t){""!=t?(this.getColumns(t),this.getGroupEventList(t)):(this.searchList.eventGroup="",this.searchList.event="",this.eventList=[{label:"All",value:""}])}},"searchList.eventGroup":{handler(t){""!=t?this.getEventList(t):(this.searchList.event="",this.eventList=[{label:"All",value:""}])}}},computed:{formConfigList(){return[{label:this.$t("IDC.auditlog.category"),key:"type",comp:"el-select",options:this.categoryList,bind:{placeholder:this.$t("common.placeholder.select")}},{label:this.$t("IDC.till.eventGroup"),key:"eventGroup",comp:"el-select",bind:{placeholder:this.$t("common.placeholder.select"),id:"eventGroup"},options:this.eventGroupList},{label:this.$t("IDC.auditlog.event"),key:"event",comp:"el-select",options:this.eventList,bind:{placeholder:this.$t("common.placeholder.select")},hidden:!1},{formItemClass:"form-special-date-box",sameGroup:!0,label:this.$t("IDC.auditlog.time"),description:this.$t("IDC.auditlog.timeDesc",{obj:this.limitDays.maxDay}),prop:"time",comp:[{key:"time",comp:"el-date-picker",bind:{align:"right",type:"datetimerange",format:"dd/MM/yyyy HH:mm:ss","range-separator":"-","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"start-placeholder":"Please select","end-placeholder":"Please select","picker-options":this.pickerOptions}},{comp:"i",class:"el-icon-date data_icon"}]}]}},methods:{getColumns(t){this.hasPage=!0,this.columns=[],this.sortArr=[],this.categoryList.forEach(e=>{e.value===t&&e.tableHead.forEach(e=>{if("TASK"===t){let t=["taskType","taskId","relatedWorkflowId"];t.includes(e.prop)&&(e.prop="extraResult."+e.prop)}e["align"]="left","logTime"===e.prop&&(e["__slotName"]="logTime",e["sort-method"]=(t,e)=>{const i=L()(t.logTime),a=L()(e.logTime);return i-a}),e["sort-method"]=(t,i)=>t[e.prop]>i[e.prop]?1:-1,this.sortArr.push(e.prop),this.columns.push(e)})}),this.columns.push({label:this.$t("IDC.auditlog.operation"),prop:"operation",align:"left",__slotName:"operation",width:"100"})},isNull(t){return!t},async getCategoryList(){let t=await Object(r["b"])();t.header&&t.header.success&&(this.categoryList=t.list||[])},async getGroupEventList(t){let e={type:t};this.searchList.eventGroup="",this.searchList.event="";let i=await Object(r["g"])(e);i.header&&i.header.success&&(this.eventGroupList=i.list)},async getLimitDay(){let t=await Object(r["c"])();t&&(this.limitDays=t.map||{maxDay:30,defaultDay:7},this.getdefaultTime(this.limitDays.defaultDay))},getdefaultTime(t){this.searchList.startTime=Object(w["a"])((new Date).getTime()-864e5*t,"YYYY-MM-DD HH:mm:ss"),this.searchList.endTime=Object(w["a"])((new Date).getTime(),"YYYY-MM-DD HH:mm:ss"),this.searchList.time=[this.searchList.startTime,this.searchList.endTime]},async getEventList(t){let e={type:this.searchList.type,eventGroup:t};this.searchList.event="";let i=await Object(r["h"])(e);i.header&&i.header.success&&(this.eventList=i.list)},reset(){this.getLimitDay(),this.isExport=!0,this.searchList={type:"",event:"",eventGroup:"",identityId:this.searchList.identityId,initiatorId:this.searchList.initiatorId,initiatorType:"",startTime:"",endTime:"",time:[]},this.isReset=!0,this.refreshTableFlag=!0,this.paginationConfig={total:0,pageIndex:1,pageSize:10},this.eventGroupList=[{label:"All",value:""}],this.eventList=[{label:"All",value:""}],this.columns=[{label:this.$t("IDC.till.initiatorType")},{label:this.$t("IDC.till.initiator")},{label:this.$t("IDC.till.times")},{label:this.$t("IDC.till.event")},{label:this.$t("IDC.auditlog.operation"),prop:"operation",align:"left",__slotName:"operation",width:"100"}]},search(){let t=this.getEmpty();t&&(this.refreshTableFlag=!0,this.paginationConfig.pageIndex=1)},getEmpty(){return""===this.searchList.type?(this.$message({message:"The category cannot be empty.",type:"warning"}),!1):!(!this.searchList.time||this.searchList.time&&0==this.searchList.time.length)||(this.$message({message:"The time cannot be empty.",type:"warning"}),!1)},exportData(t){let e=this.getEmpty();if(e){let e=Object.assign(this.searchList,{type:this.searchList.type,initiatorType:this.initiatorType,event:this.searchList.event,eventGroup:this.searchList.eventGroup,startTime:L()(this.searchList.time[0]).format("YYYY-MM-DD HH:mm:ss")||"2022-11-01 00:00:00",endTime:L()(this.searchList.time[1]).format("YYYY-MM-DD HH:mm:ss")||"2022-11-30 23:59:59",fileType:t});this.isHome?e.initiatorId=this.searchList.initiatorId:e.identityId=this.searchList.identityId,delete e.initiatorType,Object(C["a"])(r["a"],e,{fileType:t})}},async handleDetail(t){let e={auditLogId:t.auditLogId,type:t.type,logTime:t.logTime},i=await Object(r["f"])(e),a={};if(i&&i.header.success){let e=Object.assign(i.commonDetail,i.extraDetail);"Take a Call"==t.event&&(a=await Object(r["e"])({startTime:this.searchList.startTime,endTime:this.searchList.endTime,type:t.type,referenceId:t.auditLogId}),a.list.map(t=>(t.time=t.logTime.slice(0,10).split("-").join(""),t)),e.list=a.list),e.initiatorType=this.initiatorType,e["eventResult"]=i.eventResult,this.$refs.viewDetail.showDetail(e)}},handleClose(t){t()},getTableData(){if(this.isReset)return this.isReset=!1,new Promise(t=>{t({list:[],totalRecords:0,header:{success:!1}}),this.refreshTableFlag=!1,this.searchLoading=!1});let t={type:this.searchList.type,event:this.searchList.event,eventGroup:this.searchList.eventGroup,startTime:this.searchList.time&&this.searchList.time[0],endTime:this.searchList.time&&this.searchList.time[1],pageNo:this.paginationConfig.pageIndex,pageSize:this.paginationConfig.pageSize};return this.isHome?t.initiatorId=this.searchList.initiatorId:t.identityId=this.searchList.identityId,new Promise(e=>{Object(r["d"])(t).then(t=>{t&&t.header.success?(t.list=t.resultList||[],t.list.length>0?this.isExport=!1:this.isExport=!0,t.totalRecords=Number(t.totalAmount)||0,this.refreshTableFlag=!1,this.searchLoading=!1,e(t)):(t.list=[],t.totalRecords=0,this.refreshTableFlag=!1,this.searchLoading=!1,e(t))}).catch(()=>{e()})})}}},S=k,$=(i("1a78"),Object(g["a"])(S,a,s,!1,null,"dc4e9ad8",null));e["default"]=$.exports},"63ab":function(t,e,i){},bcaf:function(t,e,i){},cf2e:function(t,e,i){"use strict";i("bcaf")},fb94:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"g",(function(){return l})),i.d(e,"h",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"d",(function(){return r})),i.d(e,"f",(function(){return h})),i.d(e,"e",(function(){return d})),i.d(e,"a",(function(){return c}));var a=i("0bbd");function s(){return Object(a["a"])({url:"/fintech/v1/auditLog/getCategoryList",method:"get"})}function l(t){return Object(a["a"])({url:"/fintech/v1/auditLog/queryEventGroup",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/fintech/v1/auditLog/queryEventType",method:"post",data:t})}function n(){return Object(a["a"])({url:"/fintech/v1/auditLog/getLimitDay",method:"get"})}function r(t){return Object(a["a"])({url:"/fintech/v1/auditLog/listAuditLog",method:"post",data:t})}function h(t){return Object(a["a"])({url:"/fintech/v1/auditLog/queryAuditLogDetail",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/fintech/v1/auditLog/listTakeCallReferenceAuditLog  ",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/fintech/v1/auditLog/downloadAuditLog",method:"post",needHeader:!0,data:t,responseType:"blob"})}}}]);
//# sourceMappingURL=chunk-3c9a1c4e.js.map