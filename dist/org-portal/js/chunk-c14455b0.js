(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c14455b0"],{"0f18":function(e,t,i){e.exports={activeMenuColor:"#366bfc",primaryColor:"#366bfc",menuColor:"#5c5c5c",fillEmphasisColor:"#5c5c5c",fillLightColor:"#fafafa",fillStrongColor:"#c7c7c7",fillRegularColor:"#f0f0f0",fillColorDark:"#e0e0e0",lineStrongColor:"#8f8f8f",textEmphasisColor:"#282828",backgroundColor:"#fff",statusErrorColor:"#ff4040",statusSuccessColor:"#27bf88",statusColorwarning:"#ff7420",statusColorSAecondaryWarning:"#faaf0c",statusNoticeColor:"#338bff",statusDark:"#c7c7c7",initialColor:"#E0E0E0",statusNoticeBackgroundColor:"#F0F9FF",statusErrorBackgroundColor:"#FFF2F0",statusSuccessBackgroundColor:"#F0FFF7",statusSecondaryWarningBackgroundColor:"#FFFBE6",statusWarningBackgroundColor:"#FFF6E6",statusDarkBackgroundColor:"#FAFAFA",lineColorBlue:"#ADD9FF",lineColorError:"#FFC1BA",lineColorGreen:"#A5E6C6",lineColorWarning:"#FFF7ed"}},1211:function(e,t,i){"use strict";i("3832")},"2ece":function(e,t,i){},"32e8":function(e,t,i){},3832:function(e,t,i){},"53c2":function(e,t,i){},"560f":function(e,t,i){},"5b4e":function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.initLoading,expression:"initLoading"}],staticClass:"common-kyc-form"},[e.isEditMode&&!e.editing&&e.showEditButton?t("el-button",{staticClass:"edit-button portal-operation-button",attrs:{size:"small",loading:e.editClickLoading,icon:"el-icon-edit"},on:{click:e.handleEditButtonClick}},[e._v("Edit")]):e._e(),e.ableEditTrustLevel&&e.isEditingMode?[t("el-form",{key:"innerTrustLevelForm",ref:"innerTrustLevelForm",staticClass:"trust-level-form",attrs:{size:"small","label-position":"top",model:e.trustLevelFormData,rules:e.TRUST_LEVEL_FORM_RULES}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"Trust Level",prop:"trustLevel"}},[t("el-select",{on:{change:e.handleTrustLevelSelectChange},model:{value:e.trustLevelFormData.trustLevel,callback:function(t){e.$set(e.trustLevelFormData,"trustLevel",t)},expression:"trustLevelFormData.trustLevel"}},e._l(e.trustLevelList,(function(e){return t("el-option",{key:e.trustLevelId,attrs:{label:e.trustLevelName,value:e.trustLevelId}})})),1)],1)],1)],1)],1),t("el-divider",{staticClass:"trust-level-container-divider"})]:e._e(),t("el-form",{key:"innerKycForm",ref:"innerKycForm",attrs:{size:"small","label-position":"top",model:e.formData,"validate-on-rule-change":!1},on:{validate:e.handleValidate}},e._l(e.kycGroupList,(function(e){return t("kyc-group-item",{key:e.groupId,attrs:{item:e}})})),1),e.isEditingMode?[t("el-form",{key:"remarkForm",ref:"remarkForm",staticClass:"remark-form",attrs:{size:"small","label-position":"top",model:e.remarkFormData,rules:e.REMARK_FORM_RULES}},[t("el-form-item",{attrs:{label:"Remark",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",placeholder:"Please Enter",rows:4},model:{value:e.remarkFormData.remark,callback:function(t){e.$set(e.remarkFormData,"remark",t)},expression:"remarkFormData.remark"}})],1)],1),t("div",{staticClass:"edit-button-list"},[t("el-button",{attrs:{size:"small"},on:{click:e.handleEditResetClick}},[e._v("Cancel")]),t("el-button",{attrs:{type:"primary",size:"small",loading:e.submitBtnLoading},on:{click:e.handleEditSubmitClick}},[e._v("Submit")])],1)]:e._e()],2)},s=[],r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"kyc-group--item"},[t("kyc-group-label",{attrs:{label:e.item.realDisplayName}}),e.isMultiKYCGroupType(e.item.groupId)?t("array-kyc-group",{attrs:{item:e.item}}):t("simple-kyc-group",{attrs:{item:e.item}})],1)},l=[],n=function(){var e=this,t=e._self._c;return t("span",{staticClass:"kycGroupLabel"},[e._v(e._s(e.label))])},o=[],d={name:"KycGroupLabel",props:{label:{type:String,default:""}}},c=d,u=i("2877"),h=Object(u["a"])(c,n,o,!1,null,null,null),m=h.exports,f=function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"simple_kyc",attrs:{gutter:20}},[e._l(e.item.kycFields,(function(i){return t("el-col",e._b({key:i.fieldId},"el-col",e.colSpan,!1),[t("kyc-field-item",{attrs:{item:i,specialSimpleField:e.isSpecialSimpleField,groupEditDisabled:e.groupEditDisabled,groupId:e.groupId},on:{"special-simple-field-change":e.handleSpecialSimpleFieldChange}})],1)})),t("el-divider",{staticClass:"simple-kyc-group-divider"})],2)},p=[],y=function(){var e=this,t=e._self._c;return t("div",{class:{"kyc-group--field":!0,"inner-table":e.isMultiGroupField}},[t("el-form-item",{ref:"fieldFormItem",attrs:{label:e.isMultiGroupField?"":e.item.realDisplayName,prop:e.item.propPath,rules:e.getValidateRules}},[e.item.fieldId===e.REGION_FIELD_ID?[t("region-field",{attrs:{item:e.item,isViewMode:e.isViewMode}})]:e.item.fieldId===e.NC_LANG_FIELD_ID?[t("preferred-nc-lang-field",{attrs:{item:e.item,isViewMode:e.isViewMode}})]:e.isViewMode||e.groupEditDisabled?[t("span",{class:{view_span:!0,high_light:e.isWorkflowDiff,delete_remark:e.isWorkflowDelete}},[e._v(e._s(e.viewModeFieldValue))])]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.INPUT?[t("el-input",{attrs:{clearable:"",disabled:e.configDisabled||e.multiFieldDisabled},on:{blur:e.handleInputBlur},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}})]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.SELECT?[t("el-select",{attrs:{disabled:e.configDisabled||e.hasBankAccountDisabled||e.multiFieldDisabled,clearable:"",placeholder:"Please select"},on:{change:e.handSelectChange},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}},e._l(e.item.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.DATE?[t("el-date-picker",{attrs:{type:"date",format:"dd/MM/yyyy","value-format":"yyyyMMdd",clearable:"","picker-options":e.pickerOptions,disabled:e.configDisabled||e.multiFieldDisabled,editable:!1},on:{change:e.handleDatePickerChange},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}})]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.TIME?[t("el-date-picker",{attrs:{type:"datetime",format:"dd/MM/yyyy HH:mm:ss","value-format":"yyyyMMddHHmmss",clearable:"","picker-options":e.pickerOptions,disabled:e.configDisabled||e.multiFieldDisabled,editable:!1},on:{change:e.handleDatePickerChange},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}})]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.RADIO?[t("el-radio-group",{attrs:{disabled:e.configDisabled||e.multiFieldDisabled},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}},e._l(e.item.options,(function(i){return t("el-radio",{key:i.value,attrs:{label:i.value}},[e._v(" "+e._s(i.label)+" ")])})),1)]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.CHECKBOX?[t("el-checkbox-group",{attrs:{disabled:e.configDisabled||e.multiFieldDisabled},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}},e._l(e.item.options,(function(i){return t("el-checkbox",{key:i.value,attrs:{label:i.value}},[e._v(" "+e._s(i.label)+" ")])})),1)]:e.item.fieldType==e.KYC_DISPLAYTYPE_MAP.PICTURE?[t("el-input",{attrs:{disabled:""},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}})]:e._e()],2)],1)},g=[],C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"region_field_container"},[e.isViewMode?t("span",{class:{high_light:e.isWorkflowDiff,delete_remark:e.isWorkflowDelete}},[e._v(e._s(e.regionCode2FullNameMap[e.item.fieldValue]||e.item.fieldValue||"-"))]):t("el-select",{attrs:{clearable:"",placeholder:"Please select","popper-append-to-body":!1},on:{clear:e.handleRegionClear,focus:e.handleRegionFocus},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}},[t("template",{slot:"prefix"},[t("i",{staticClass:"region-more el-icon-more el-icon--right icon-cursor"})]),e.validRegionCode2FullNameMap?e._l(e.regionCode2FullNameMap,(function(e,i){return t("el-option",{key:i,attrs:{label:e,value:i}})})):e._e()],2),t("portal-dialog",{attrs:{visible:e.dialogVisible,title:"Select Region",width:"600px",top:"12vh","append-to-body":"","destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.handleDialogOpened,"cancel-btn-click":e.handleDialogCancel,"confirm-btn-click":e.handleDialogConfirm},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticClass:"select_tree_container"},[t("el-input",{attrs:{clearable:"",size:"small","suffix-icon":"el-icon-search"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),t("el-tree",{ref:"regionTree",attrs:{data:e.treeData,"highlight-current":"","show-checkbox":"","node-key":"regionCode","check-strictly":"",accordion:"","default-checked-keys":e.checkedKeys,"default-expanded-keys":e.checkedKeys,indent:26,props:e.defaultProps,"filter-node-method":e.filterNode},on:{check:e.handleTreeNodeCheck}})],1)]},proxy:!0}])})],1)},k=[],b=i("8ac9"),D=i("c004"),v=i("3cf3"),F={name:"RegionField",components:{PortalDialog:b["a"]},props:{item:{type:Object,default:()=>{}},isViewMode:Boolean},inject:["kycForm"],data(){return{dialogVisible:!1,searchText:"",checkedKeys:[],defaultProps:{children:"regionInfoTreeDatas",label:"regionName"},treeData:[],regionCode2FullNameMap:[]}},computed:{validRegionCode2FullNameMap(){return Object.keys(this.regionCode2FullNameMap).length},isWorkflowDiff(){return Object(D["r"])(this.item)},isWorkflowDelete(){return Object(D["q"])(this.item)}},watch:{searchText(e){this.$refs.regionTree.filter(e)},dialogVisible(e){e||this.kycForm&&this.kycForm.validateField(this.item.propPath)}},created(){this.getRegionData(),this.item.fieldValue&&(this.checkedKeys=[this.item.fieldValue])},methods:{handleRegionClear(){this.checkedKeys=[],this.$refs.regionTree&&this.$refs.regionTree.setCheckedKeys([])},handleRegionFocus(){this.dialogVisible=!0},handleDialogOpened(){this.$refs.regionTree.setCurrentKey(this.checkedKeys[0]||null)},handleDialogCancel(){this.dialogVisible=!1},handleDialogConfirm(){this.item.fieldValue=this.checkedKeys[0],this.dialogVisible=!1},filterNode(e,t){if(!e)return!0;let i=e.toLowerCase(),a=t[this.defaultProps.label].toLowerCase();return-1!==a.indexOf(i)},handleTreeNodeCheck(e,t){const{checkedKeys:i}=t;i.length>this.checkedKeys.length?this.checkedKeys=i.filter(e=>!this.checkedKeys.includes(e)):this.checkedKeys=i,this.$refs.regionTree.setCheckedKeys(this.checkedKeys)},getRegionData(){Object(v["f"])().then(e=>{const{header:t,regionInfoTreeDatas:{regionInfoTreeDatas:i=[]}}=e;t&&t.success&&(Object(D["t"])(i),this.regionCode2FullNameMap=Object(D["p"])(i),this.treeData=i)})}}},M=F,I=(i("c922"),Object(u["a"])(M,C,k,!1,null,"0a58295c",null)),E=I.exports,Y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"nc_language"},[e.isViewMode?t("span",{class:{high_light:e.isWorkflowDiff,delete_remark:e.isWorkflowDelete}},[e._v(e._s(e.languageMap[e.item.fieldValue]||"-"))]):t("el-select",{attrs:{clearable:"",placeholder:"Please select"},on:{change:e.handleChange},model:{value:e.item.fieldValue,callback:function(t){e.$set(e.item,"fieldValue",t)},expression:"item.fieldValue"}},e._l(e.langOptions,(function(e){return t("el-option",{key:e.languageCode,attrs:{label:e.languageName,value:e.languageCode}})})),1)],1)},w=[],O={name:"PreferredNotificationLang",props:{item:{type:Object,default:()=>{}},isViewMode:Boolean},inject:["kycForm"],data(){return{langOptions:[],languageMap:{}}},computed:{isWorkflowDiff(){return Object(D["r"])(this.item)},isWorkflowDelete(){return Object(D["q"])(this.item)}},created(){this.getLanguageList()},methods:{handleChange(){this.kycForm&&this.kycForm.validateField(this.item.propPath)},getLanguageList(){Object(v["c"])().then(e=>{const{header:t,list:i=[]}=e;t&&t.success&&(this.langOptions=i,this.languageMap=i.reduce((e,t)=>(e[t["languageCode"]]=t["languageName"],e),{}))})}}},K=O,L=(i("8120"),Object(u["a"])(K,Y,w,!1,null,"5b02730f",null)),V=L.exports,T=i("7dfc"),R=i("02e3"),_=i("5a0c"),P=i.n(_);const x={trustLevel:[R["z"]]},$={remark:[R["e"]]},S={required:!0,message:"This field is mandatory.",trigger:"blur"},B={required:!0,message:"This field is mandatory.",trigger:"blur"},A={required:!0,message:"This field is mandatory.",trigger:"change"};function j(e,t,i){const{algorithm:a,promptInfo:s,beginValue:r,endValue:l}=e;let n="";return n=1004==t?"The value can not match the KYC rule extending.":s||i||"Invalid value.",{validator:(e,t,i)=>{const s=P()(t,"YYYYMMDD").unix();switch(a){case D["b"].DAY:case D["b"].ANNIVERSARY:case D["b"].BIRTHDAY:G(s,r,l,n,i,"day");break;case D["b"].MONTH:G(s,r,l,n,i,"month");break;case D["b"].YEAR:G(s,r,l,n,i,"year");break;case D["b"].FIXED_DATE:G(s,r,l,n,i,"fixed");break;default:i();break}},trigger:"change"}}function G(e,t,i,a,s,r){let l=null,n=null;t&&(l="fixed"===r?P()(i,"DD-MM-YYYY").unix():P()().subtract(parseInt(t),r).unix(),e>l)||i&&(n="fixed"===r?P()(t,"DD-MM-YYYY").unix():P()().subtract(parseInt(i),r).unix(),e<n)?s(a):s()}var N=i("2ef0");function H(e){const t=e.dataDictItems||[],i=t.map(e=>({value:e.value,label:e.defaultName}));return i}function W(e,t){let i="",a="",{fieldType:s,fieldValue:r,dataDictItemsMap:l=[]}=Object(N["cloneDeep"])(e);switch(s){case D["c"].RADIO:case D["c"].SELECT:case D["c"].CHECKBOX:Array.isArray(r)?("review"===t&&(r=r.map(e=>l[e])),i=r.join(",")):("review"===t&&(r=l[r]),i=r||"-");break;case D["c"].DATE:a=r.includes("-")?"DD-MM-YYYY":"YYYYMMDD",i=Object(T["a"])(r,"DD/MM/YYYY",a),"Invalid Date"===i&&(i=Object(T["a"])(r,"DD/MM/YYYY",a));break;case D["c"].TIME:i=Object(T["a"])(r,"DD/MM/YYYY HH:mm:ss","YYYYMMDDHHmmss"),"Invalid Date"===i&&(i=Object(T["a"])(r,"DD/MM/YYYY HH:mm:ss","YYYYMMDDHHmmss"));break;case D["c"].PICTURE:i=r;break;default:i=r;break}return i}var q={name:"KycFieldItem",components:{RegionField:E,PreferredNcLangField:V},props:{item:{type:Object,default(){return{}}},isMultiGroupField:{type:Boolean,default:!1},colIndex:Number,specialSimpleField:{type:Boolean,default:!1},groupEditDisabled:{type:Boolean,default:!0},groupId:{type:[String,Number],default:""}},inject:["kycForm"],data(){return{KYC_DISPLAYTYPE_MAP:D["c"],REGION_FIELD_ID:D["g"],NC_LANG_FIELD_ID:D["f"]}},computed:{isViewMode(){return this.kycForm.isViewMode},mode(){return this.kycForm.mode},kycRuleExtList(){return this.kycForm.kycRuleExtList},currFieldExtRule(){const{kycRuleExt:e}=this.kycRuleExtList.find(e=>e.kycFieldId==this.item.fieldId)||{};return e},fieldFormItem(){return this.$refs.fieldFormItem||null},allBasicProductMandatory(){return this.kycForm.basicProductMandatory},isBasicProductMandatory(){let e=this.allBasicProductMandatory[0];if("Object"===Object.prototype.toString.call(e).slice(8,-1)){let e=this.allBasicProductMandatory.findIndex(e=>e.kycGroupID===this.groupId&&e.kycFieldID===this.item.fieldId);return-1!==e}return this.allBasicProductMandatory.includes(this.item.fieldId)},allTrustLevelMandatory(){return this.kycForm.trustLevelMandatory},isTrustLevelMandatory(){return this.allTrustLevelMandatory.includes(this.item.fieldId)},getValidateRules(){if(this.isViewMode)return[];if(this.kycForm.isEditMode&&this.isSensitive&&this.sameAsMask)return[this.getRequiredValidateRule].filter(e=>!!e);const e=[this.getRequiredValidateRule,this.getRegexpValidateRule,this.getExtValidateRule].filter(e=>!!e);return e},viewModeFieldValue(){const e=this.item;return e.fieldValue?W(e,this.mode):"-"},hasBankAccountDisabled(){return!this.isMultiGroupField&&1029===this.item.fieldId},isSensitive(){return"1"===this.item.sensitive},sameAsMask(){return this.item.fieldValue===this.item.value},configDisabled(){return"true"===this.item.disabled},multiFieldDisabled(){return this.isMultiGroupField&&!0===this.item.multiDisabled},isBirthDate(){return 1004===this.item.fieldId},isEffectiveDate(){return[104,204].includes(this.item.fieldId)},isExpiryDate(){return[105,205].includes(this.item.fieldId)},pickerOptions(){return this.isBirthDate||this.isEffectiveDate?{disabledDate(e){return e.getTime()>Date.now()}}:this.isExpiryDate?{disabledDate(e){return e.getTime()<Date.now()-864e5}}:{}},isFirstColumn(){return 0===this.colIndex},isMultiGroupFirstColumn(){return this.isMultiGroupField&&this.isFirstColumn},getRequiredValidateRule(){const{mandatory:e,simpleRelevancyMandatory:t,multiRelevancyMandatory:i,fieldType:a}=this.item,{isBasicProductMandatory:s,isTrustLevelMandatory:r,allBasicProductMandatory:l,allTrustLevelMandatory:n}=this;let o=null,d=null;if(d=l.length||n.length?s||r:"true"===e,d||t||i)switch(a){case D["c"].SELECT:o=A;break;case D["c"].CHECKBOX:o=B;break;default:o=S}return o},getRegexpValidateRule(){const{expression:e,validationDisplayName:t}=this.item;let i=null;return e&&(i={pattern:new RegExp(e),message:t||"Invalid value.",trigger:"blur"}),i},getExtValidateRule(){let e=null;return this.currFieldExtRule&&(e=j(this.currFieldExtRule,this.item.fieldId,this.item.validationDisplayName)),e},isWorkflowDiff(){return Object(D["r"])(this.item)},isWorkflowDelete(){return Object(D["q"])(this.item)}},watch:{isViewMode(e,t){if(["edit","workflowDiff","workflowEdit"].includes(this.mode)&&!1===e&&!0===t){const{fieldType:e,fieldValue:t}=this.item;if([D["c"].DATE,D["c"].TIME].includes(e)&&t){const e=this.item.fieldType===D["c"].DATE?"YYYYMMDD":"YYYYMMDDHHmmss",i=this.item.fieldType===D["c"].DATE?"DD-MM-YYYY":"YYYYMMDDHHmmss";let a=Object(T["a"])(t,e,i);"Invalid Date"===a&&(a=Object(T["a"])(t,e,i)),this.$set(this.item,"fieldValue",a)}this.initOptions()}}},created(){this.initOptions()},methods:{initOptions(){if([D["c"].SELECT,D["c"].RADIO,D["c"].CHECKBOX].includes(this.item.fieldType)){const e=H(this.item);if(this.$set(this.item,"options",e),this.item.fieldType===D["c"].CHECKBOX){let e=String(this.item.fieldValue);this.$set(this.item,"fieldValue",e.split(","))}}},handSelectChange(e){this.isMultiGroupFirstColumn&&this.$emit(e?"first-column-valid":"first-column-invalid"),this.specialSimpleField&&this.$emit("special-simple-field-change",e),this.item.fieldId&&this.$nextTick(()=>{this.kycForm.validateField(this.item.propPath)})},clearValidate(){this.$refs.fieldFormItem&&this.$refs.fieldFormItem.clearValidate()},resetField(){this.$refs.fieldFormItem&&this.$refs.fieldFormItem.resetField()},handleInputBlur(){this.item.fieldId&&this.kycForm.isEditMode&&this.kycForm.validateField(this.item.propPath)},handleDatePickerChange(){this.item.fieldId&&this.kycForm.validateField(this.item.propPath)}}},z=q,U=(i("1211"),Object(u["a"])(z,y,g,!1,null,"4fde1717",null)),X=U.exports,J={name:"SimpleKycGroup",components:{KycFieldItem:X},props:{item:{type:Object,default(){return{}}}},inject:["kycForm"],computed:{isViewMode(){return this.kycForm.isViewMode},mode(){return this.kycForm.mode},groupId(){return this.item.groupId},groupEnable(){return this.item.groupEnable},groupEditDisabled(){return"edit"===this.mode&&!this.groupEnable},isAdaptiveLayout(){return this.kycForm.adaptiveLayout},isContactDetailsGroup(){return 1007===this.groupId},isSpecialSimpleField(){return this.isContactDetailsGroup},colSpan(){return this.isAdaptiveLayout?{xs:8,sm:8,md:8,lg:8,xl:6}:{span:8}}},watch:{isViewMode(e,t){if(["edit","workflowDiff","workflowEdit"].includes(this.mode)&&!1===e&&!0===t&&this.isContactDetailsGroup){let{kycFields:e=[]}=this.item,t=e.find(e=>1013===e.fieldId)||{};this.handleContactDetailsGroup(t.fieldValue||"")}}},methods:{handleSpecialSimpleFieldChange(e){this.isContactDetailsGroup&&this.handleContactDetailsGroup(e)},handleContactDetailsGroup(e){let t=this.item.kycFields.find(e=>1014===e.fieldId)||{},i=this.item.kycFields.find(e=>1015===e.fieldId)||{};const a=t.propPath,s=i.propPath;"1011"===e?(this.$set(t,"simpleRelevancyMandatory",!1),this.$set(i,"simpleRelevancyMandatory",!0)):"1001"===e?(this.$set(t,"simpleRelevancyMandatory",!0),this.$set(i,"simpleRelevancyMandatory",!1)):(this.$set(t,"simpleRelevancyMandatory",!1),this.$set(i,"simpleRelevancyMandatory",!1),t.fieldValue="",i.fieldValue=""),this.$nextTick(()=>{a&&this.kycForm.validateField(a),s&&this.kycForm.validateField(s)})}}},Q=J,Z=(i("b86d"),Object(u["a"])(Q,f,p,!1,null,"9dcbfbba",null)),ee=Z.exports,te=function(){var e=this,t=e._self._c;return t("div",{staticClass:"array-kyc-group"},[e.displayAddDeleteBtn?t("el-button",{staticClass:"add_button",attrs:{size:"small"},on:{click:e.addRow}},[e._v(e._s(e.addButtonText))]):e._e(),t("el-table",{ref:"multiGroupTable",staticClass:"multi_table",attrs:{data:e.item.fieldValues,border:""}},[e._l(e.kycFields,(function(i,a){return t("el-table-column",{key:i.fieldId,attrs:{minWidth:30,align:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",[t("span",{directives:[{name:"show",rawName:"v-show",value:e.needRequired(i),expression:"needRequired(colField)"}],staticClass:"red-star"},[e._v("*")]),e._v(" "+e._s(i.realDisplayName)+" ")])]},proxy:!0},{key:"default",fn:function(i){return[t("el-tooltip",{attrs:{effect:"light",placement:"top-start","popper-class":"kyc-multi-group-tooltip","arrow-offset":40,content:i.row[a].multiFieldVerifyErrorMessage,disabled:!i.row[a].isMultiFieldVerifyError}},[t("kyc-field-item",{ref:e.getFieldPropPath(i,a),refInFor:!0,attrs:{item:e.getFieldItem(i,a),colIndex:a,isMultiGroupField:!0,groupEditDisabled:e.groupEditDisabled,groupId:e.groupId},on:{"first-column-valid":function(t){return e.handleFirstColumnValid(i.row)},"first-column-invalid":function(t){return e.handleFirstColumnInvalid(i.row)}}})],1)]}}],null,!0)})})),e.displayAddDeleteBtn?t("el-table-column",{attrs:{label:"Operation",fixed:"right",align:"left",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(i){return 0!==i.$index?[t("el-button",{staticClass:"operation-button",attrs:{size:"small",type:"text"},on:{click:function(t){return e.deleteRow(i.$index)}}},[e._v("Delete")])]:void 0}}],null,!0)}):e._e()],2)],1)},ie=[],ae={name:"ArrayKycGroup",components:{KycFieldItem:X},props:{item:{type:Object,default(){return{}}}},inject:["kycForm"],computed:{isViewMode(){return this.kycForm.isViewMode},mode(){return this.kycForm.mode},allBasicProductMandatory(){return this.kycForm.basicProductMandatory},allTrustLevelMandatory(){return this.kycForm.trustLevelMandatory},kycFields(){return this.item.kycFields||[]},groupId(){return this.item.groupId},groupEnable(){return this.item.groupEnable},groupEditDisabled(){return"edit"===this.mode&&!this.groupEnable},displayAddDeleteBtn(){return!this.isViewMode&&!this.groupEditDisabled},isIDDetailsGroup(){return 100===this.groupId},isCertificateDetailsGroup(){return 200===this.groupId},addButtonText(){return"Add"+(D["a"][this.groupId]?" "+D["a"][this.groupId]:"")},validFieldValuesLength(){return this.item.fieldValues.filter(e=>e[0].fieldValue).length}},watch:{isViewMode(e,t){if(["edit","workflowDiff","workflowEdit"].includes(this.mode)&&!1===e&&!0===t){if(!this.item.fieldValues.length)return;let e=this.item.fieldValues[0],t=e[0];(this.isIDDetailsGroup||this.isCertificateDetailsGroup)&&this.handleMultiGroupSpecialRelevancy(e,!!t.fieldValue,!0)}}},methods:{needRequired(e){const{mandatory:t,multiRelevancyMandatory:i,fieldId:a}=e,{allBasicProductMandatory:s,allTrustLevelMandatory:r,isViewMode:l}=this,n=this.getIsBasicProductMandatory(s,a),o=r.includes(a);let d=null;return d=s.length||r.length?n||o:"true"===t,(d||i)&&!l},getIsBasicProductMandatory(e,t){let i=e[0];if("Object"===Object.prototype.toString.call(i).slice(8,-1)){let i=e.findIndex(e=>e.kycGroupID===this.groupId&&e.kycFieldID===t);return-1!==i}return e.includes(t)},getFieldItem(e,t){const i=e.row[t],a=e.$index,s=`${this.groupId}.fieldValues.${a}.${t}.fieldValue`;return i.propPath=s,i},getFieldPropPath(e,t){const i=e.row[t];return i["propPath"]},async addRow(){if(this.hasEmptyRow())return;const e=await this.validateRowsMandatory();e&&this.item.fieldValues.push(Object(N["cloneDeep"])(this.item.kycFields))},hasEmptyRow(){let e=!1;return this.item.fieldValues.forEach(t=>{e=!t.some(e=>e.fieldValue)}),e},validateRowsMandatory(){return new Promise(e=>{let t=!1;const i=[],a=[];if(this.item.kycFields.forEach((e,t)=>{const{mandatory:i,multiRelevancyMandatory:s}=e;("true"===i||s)&&a.push(t)}),this.item.fieldValues.forEach(e=>{e.forEach((e,t)=>{a.includes(t)&&i.push(e.propPath)})}),i.length){i.forEach(e=>{this.kycForm.validateField(e)});const e=i.map(e=>this.$refs[e][0]?this.$refs[e][0].fieldFormItem.validateState:null).filter(e=>e);t=!e.includes("error")}else t=!0;e(t)})},deleteRow(e){this.$confirm("Are you sure to delete it?","Confirm",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning",closeOnClickModal:!1}).then(()=>{this.item.fieldValues.splice(e,1)}).catch(()=>{})},handleFirstColumnValid(e){e.forEach((e,t)=>{0!==t&&(e.multiDisabled=!1)}),this.handleMultiGroupSpecialRelevancy(e,!0)},handleFirstColumnInvalid(e){e.forEach((e,t)=>{0!==t&&(e.multiDisabled=!0,e.fieldValue=null)}),this.handleMultiGroupSpecialRelevancy(e,!1)},handleMultiGroupSpecialRelevancy(e,t,i){this.isIDDetailsGroup&&this.handleIDDetailKYCGroup(e,t,i),this.isCertificateDetailsGroup&&this.handleCertificateDetailsKYCGroup(e,t,i)},handleIDDetailKYCGroup(e,t,i){let a=e.find(e=>103===e.fieldId),s=this.kycFields.find(e=>103===e.fieldId);t?(this.$set(a,"multiRelevancyMandatory",!0),(1===this.validFieldValuesLength||i)&&this.$set(s,"multiRelevancyMandatory",!0)):(this.$set(a,"multiRelevancyMandatory",!1),this.$set(a,"isMultiFieldVerifyError",!1),this.$set(a,"multiFieldVerifyErrorMessage",""),0===this.validFieldValuesLength&&this.$set(s,"multiRelevancyMandatory",!1))},handleCertificateDetailsKYCGroup(e,t,i){let a=e.filter(e=>"00"===e.fieldType),s=this.kycFields.filter(e=>"00"===e.fieldType);t?(a.forEach(e=>{this.$set(e,"multiRelevancyMandatory",!0)}),(1===this.validFieldValuesLength||i)&&s.forEach(e=>{this.$set(e,"multiRelevancyMandatory",!0)})):(a.forEach(e=>{this.$set(e,"multiRelevancyMandatory",!1),this.$set(e,"isMultiFieldVerifyError",!1),this.$set(e,"multiFieldVerifyErrorMessage","")}),0===this.validFieldValuesLength&&s.forEach(e=>{this.$set(e,"multiRelevancyMandatory",!1)}))}}},se=ae,re=(i("6b41"),i("9e2e"),Object(u["a"])(se,te,ie,!1,null,"498d0dda",null)),le=re.exports,ne={name:"KycGroupItem",components:{KycGroupLabel:m,SimpleKycGroup:ee,ArrayKycGroup:le},props:{item:{type:Object,default(){return{}}}},methods:{isMultiKYCGroupType:D["s"]}},oe=ne,de=(i("8978"),Object(u["a"])(oe,r,l,!1,null,"abe19e22",null)),ce=de.exports,ue={name:"KycForm",components:{KycGroupItem:ce},props:{kycInfo:{type:Object,default:()=>({})},identityType:[Number,String],identityId:[Number,String],identityClassify:{type:String,default:"customer",validator:function(e){return["customer","spOper","org","orgOper","group","bank"].includes(e)}},mode:{type:String,default:"create",validator:function(e){return["create","edit","detail","review","workflowDiff","workflowEdit"].includes(e)}},showEditButton:{type:Boolean,default:!0},reviewKycData:{type:Object,default:()=>({})},adaptiveLayout:{type:Boolean,default:!1},basicProductId:[Number,String],incomingData:{type:Object,default:()=>({})},roleIds:{type:Array,default:()=>[]},isSelfOrgOper:{type:Boolean,default:!1},isDataEcho:{type:Boolean,default:!1}},provide(){return{mode:this.mode,kycForm:this}},data(){return{TRUST_LEVEL_FORM_RULES:x,REMARK_FORM_RULES:$,initLoading:!1,formData:{},identityKYCDetail:{},identityKYCEditInfo:{},multiRecordIdMap:{},basicProductMandatory:[],trustLevelMandatory:[],editing:!1,editClickLoading:!1,workflowEditLoading:!1,trustLevelFormData:{trustLevel:""},trustLevelList:[],remarkFormData:{remark:""},submitBtnLoading:!1,kycRuleExtList:[]}},computed:{kycGroupList(){const e=Object.values(this.formData);return e.sort((e,t)=>e.displayOrder-t.displayOrder),e},groupDisableIdList(){return this.kycGroupList.filter(e=>!e.groupEnable).map(e=>e.groupId)},isCreateMode(){return"create"===this.mode},isDetailMode(){return"detail"===this.mode},isEditMode(){return["edit","workflowEdit"].includes(this.mode)},isReviewMode(){return"review"===this.mode},isWorkflowDiffMode(){return"workflowDiff"===this.mode},isCreateOrEditMode(){return["create","edit"].includes(this.mode)},isEditOrDetailMode(){return["edit","detail"].includes(this.mode)},isEditReviewMode(){return this.isEditMode&&!this.editing},isEditingMode(){return this.isEditMode&&this.editing},isViewMode(){return["detail","review"].includes(this.mode)||this.isEditReviewMode||this.isWorkflowDiffMode},ableEditTrustLevel(){return["customer","org","group"].includes(this.identityClassify)},needKYCDataEcho(){return this.incomingData["kycDataEcho"]&&this.isDataEcho},getIdentityKYCConfigApi(){switch(this.identityClassify){case"customer":return v["a"].getCustomerKYCConfig;case"org":return v["a"].getOrgKYCConfig;case"spOper":return v["a"].getSpOperatorKYCConfig;case"orgOper":return v["a"].getOrgOperatorKYCConfig;case"group":return v["a"].getGroupKYCConfig;case"bank":return v["a"].getBankKYCConfig;default:return v["a"].getCustomerKYCConfig}},getIdentityKYCDetailApi(){switch(this.identityClassify){case"customer":return v["a"].getCustomerKYCDetail;case"org":return v["a"].getOrgKYCDetail;case"spOper":return v["a"].getSpOperatorKYCDetail;case"orgOper":return v["a"].getOrgOperatorKYCDetail;case"group":return v["a"].getGroupKYCDetail;case"bank":return v["a"].getBankKYCDetail;default:return v["a"].getCustomerKYCDetail}},getIdentityKYCEditApi(){switch(this.identityClassify){case"customer":return v["a"].getCustomerKYCEditInfo;case"orgOper":return v["a"].getOrgOperatorKYCEditInfo;case"org":return v["a"].getOrgKYCEditInfo;case"group":return v["a"].getGroupKYCEditInfo;default:return v["a"].getCustomerKYCEditInfo}},changeBasicProduct(){switch(this.identityClassify){case"customer":return v["a"].changeBasicProduct;case"org":return v["a"].changeOrgBasicProduct;case"spOper":return v["a"].getSpOperatorKYCConfig;case"orgOper":return v["a"].getOrgOperatorKYCConfig;case"group":return v["a"].getGroupKYCConfigOnChangeBasicProduct;default:return v["a"].changeBasicProduct}},checkTrustLevelChangeFuc(){switch(this.identityClassify){case"customer":return v["a"].checkTrustLevelChange;case"org":return v["a"].checkOrgTrustLevelChange;case"orgOper":return v["a"].checkOrgOperatorTrustLevelChange;case"group":return v["a"].checkGroupTrustLevelChange;default:return v["a"].checkTrustLevelChange}},detailParams(){switch(this.identityClassify){case"customer":return{identityId:this.identityId,customerId:this.identityId};case"spOper":return this.identityId;case"bank":return this.identityId;case"org":return{identityId:this.identityId,identitySubType:this.identityType};case"orgOper":return{identityId:this.identityId};default:return{identityId:this.identityId,customerId:this.identityId}}},updateKYCAPI(){switch(this.identityClassify){case"customer":return v["a"].updateIdentityKYC;case"org":return v["a"].updateOrgIdentityKYC;case"spOper":return v["a"].getSpOperatorKYCConfig;case"orgOper":return v["a"].updateOrgOperatorKYCConfig;case"group":return v["a"].updateGroupIdentityKYC;default:return v["a"].updateIdentityKYC}}},watch:{formData:{handler(e){e&&this.isCreateOrEditMode&&this.$emit("update:kycInfo",Object(N["cloneDeep"])(e))},deep:!0},identityKYCDetail:{handler(e){e&&this.isEditOrDetailMode&&(this.formData=Object(N["cloneDeep"])(e))},deep:!0},identityKYCEditInfo:{handler(e){e&&this.isEditMode&&(this.formData=Object(N["cloneDeep"])(e),setTimeout(()=>{this.originEditKYCData=this.getKYCRequestParams("update")},0))},deep:!0},reviewKycData:{handler(e){this.isReviewMode&&(this.formData=Object(N["cloneDeep"])(e))},deep:!0},basicProductId(e){this.isCreateMode&&(e?this.getBasicProductMandatory():this.basicProductMandatory=[])},roleIds(e){this.isCreateMode&&(e?this.getKYCConfig():this.roleIds=[])},"incomingData.diffKYCData":{handler(e){this.formData=Object(D["k"])(Object(N["cloneDeep"])(e)||{})},deep:!0}},async created(){this.initLoading=!0,this.isCreateMode?await this.getKYCConfig():this.isEditOrDetailMode?await this.getKYCDetail():this.isWorkflowDiffMode?this.formData=Object(D["k"])(this.incomingData.diffKYCData||{}):this.formData=this.reviewKycData,this.initLoading=!1},methods:{getKYCConfig(){let e={};return"org"===this.identityClassify&&(e.identitySubType=this.identityType),"orgOper"===this.identityClassify&&(e.roleIds=this.roleIds),this.getIdentityKYCConfigApi(e).then(e=>{const{header:t,identityKYCDataBean:i={}}=e;if(t&&t.success){this.kycRuleExtList=i[D["d"]]||[],delete i[D["d"]];let e=i;e=Object(D["m"])(e),this.needKYCDataEcho&&(e=Object(D["h"])(e,this.incomingData["kycDataEcho"])),this.formData=Object(D["j"])(e),this.$emit("get-kyc-config-success",i)}}).catch(()=>{})},getKYCDetail(){return this.getIdentityKYCDetailApi(this.detailParams).then(e=>{const{header:t,identityKYCDataBean:i={}}=e;t&&t.success&&(this.kycRuleExtList=i[D["d"]]||[],delete i[D["d"]],this.identityKYCDetail=Object(D["k"])(i),this.$emit("get-kyc-detail-success",i))}).catch(()=>{})},getKYCEditInfo(){let e={identityId:this.identityId};return this.editClickLoading=!0,this.getIdentityKYCEditApi(e).then(e=>{const{header:t,identityKYCDataBean:i={},changeTrustLevelList:a=[],selectTrustLevelId:s}=e;if(t&&t.success){this.kycRuleExtList=i[D["d"]]||[],delete i[D["d"]],this.identityKYCEditInfo=Object(D["l"])("workflowEdit"===this.mode?Object(N["cloneDeep"])(this.incomingData.diffKYCData):i),a.length&&(this.trustLevelList=a),s&&(this.trustLevelFormData.trustLevel=s);let e=a.find(e=>e.trustLevelId===s);return e&&(this.trustLevelMandatory=e.mandatoryKycFieldIds),this.multiRecordIdMap=Object(D["o"])(Object(N["cloneDeep"])(this.identityKYCEditInfo)),this.$emit("get-kyc-editInfo-success",{identityKYCDataBean:i,changeTrustLevelList:a,selectTrustLevelId:s}),!0}}).catch(()=>{}).finally(()=>{this.editClickLoading=!1})},getBasicProductMandatory(){let e={basicProductId:this.basicProductId};"org"===this.identityClassify&&(e.identitySubType=this.identityType),this.changeBasicProduct(e).then(e=>{const{header:t,mandatoryKycFieldIds:i=[],mandatoryKycFieldList:a=[]}=e;t&&t.success&&(this.basicProductMandatory=["group"].includes(this.identityClassify)?a:i)})},getKYCRequestParams(e){return Object(D["i"])(this.formData,e,e?this.multiRecordIdMap:null)},validate(e){return this.$refs.innerKycForm&&this.$refs.innerKycForm.validate(e)},validateField(e,t){this.$refs.innerKycForm&&this.$refs.innerKycForm.validateField(e,t)},resetFields(){this.$refs.innerKycForm&&this.$refs.innerKycForm.resetFields()},clearValidate(){this.$refs.innerKycForm&&this.$refs.innerKycForm.clearValidate()},async handleEditButtonClick(){const e=await this.getKYCEditInfo();e&&(this.editing=!0,this.$emit("start-edit-kyc"),this.$store.commit("baseStore/SET_KYCFORM_CHANGE",{personalSettings:!0}))},handleTrustLevelSelectChange(e){let t=this.trustLevelList.find(t=>t.trustLevelId===e);t&&(this.trustLevelMandatory=t.mandatoryKycFieldIds)},handleEditResetClick(){this.$confirm("Are you sure to cancel the operation?",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",closeOnClickModal:!1,type:"warning"}).then(()=>{this.formData=this.identityKYCDetail,this.editing=!1,this.remarkFormData.remark="",this.clearValidate(),"workflowEdit"===this.mode&&this.$emit("workflow-kyc-cancel"),this.$emit("edit-reset-click"),this.$store.commit("baseStore/SET_KYCFORM_CHANGE",{personalSettings:!1})})},handleEditSubmitClick(){let e=[this.$refs.innerKycForm.validate()];this.$refs.innerTrustLevelForm&&e.push(this.$refs.innerTrustLevelForm.validate()),this.$refs.remarkForm&&e.push(this.$refs.remarkForm.validate()),Promise.all(e).then(()=>{Object(D["n"])(Object(N["cloneDeep"])(this.originEditKYCData),this.getKYCRequestParams("update"))?this.$confirm("There is no modification.","System Info",{confirmButtonText:"Confirm",type:"warning",closeOnClickModal:!1,showCancelButton:!1}).then(()=>{}).catch(()=>{}):this.handleSubmitProcess()}).catch(e=>{const t=Object.keys(e).map(e=>parseInt(e.split(".")[0])),i=this.groupDisableIdList.map(e=>parseInt(e));this.isEditMode&&t.some(e=>i.includes(e))&&this.$message({message:"Missing KYC permission, please check KYC data permission and try again",type:"warning"})})},async handleSubmitProcess(){let e=await this.checkTrustLevelChange();if(this.$emit("edit-check-trustlevel-change",e),e.header&&e.header.success){const{change:t}=e;let i=!0;["customer","org","group"].indexOf(this.identityClassify)>0&&(i=e.canDowngrading),i?!0===t?this.$confirm("Modifying KYC infomation will cause a trust level change. Are you sure to continue?","Confirm",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning",closeOnClickModal:!1}).then(()=>{this.updateIdentityKYC()}).catch(()=>{}):!1===t&&this.updateIdentityKYC():this.$confirm("The trust level cannot be downgraded to the current level.","System Info",{confirmButtonText:"Confirm",showCancelButton:!0,type:"info",closeOnClickModal:!1}),this.$store.dispatch("tagsView/delView",this.$route),["group"].indexOf(this.identityClassify)<0&&this.$router.push("list")}},handleValidate(e,t,i){let a=e.split(".");if(D["e"].includes(parseInt(a[0]))){let e=a.slice(0,-1),s=Object(N["get"])(this.formData,e);this.$set(s,"isMultiFieldVerifyError",!t),this.$set(s,"multiFieldVerifyErrorMessage",t?"":i)}},checkTrustLevelChange(){let e={identityId:this.identityId,identityKYCData:this.getKYCRequestParams()};return this.submitBtnLoading=!0,this.checkTrustLevelChangeFuc(e).finally(()=>{this.submitBtnLoading=!1})},updateIdentityKYC(){if("workflowEdit"===this.mode)return void this.$emit("workflow-kyc-submit",this.getKYCRequestParams("update"),this.remarkFormData.remark);let e={identityId:this.identityId,identityKYCData:this.getKYCRequestParams("update"),reason:this.remarkFormData.remark};this.submitBtnLoading=!0,this.isSelfOrgOper&&(e.isSelfOrgOper=!0),this.updateKYCAPI(e).then(async e=>{const{header:t}=e;t&&t.success?(e.taskId?this.$message.success("The request must be approved by another operator."):this.$message.success("submitted successfully."),this.$emit("edit-submit-success",e),this.editing=!1,this.initLoading=!0,await this.getKYCDetail(),this.initLoading=!1,this.remarkFormData.remark=""):this.$emit("edit-submit-failure",e)}).catch(e=>{this.$emit("edit-submit-failure",e)}).finally(()=>{this.submitBtnLoading=!1})}}},he=ue,me=(i("6dd8f"),Object(u["a"])(he,a,s,!1,null,"2bc19ff8",null));t["a"]=me.exports},"6b41":function(e,t,i){"use strict";i("0f18")},"6dd8f":function(e,t,i){"use strict";i("2ece")},8120:function(e,t,i){"use strict";i("fb4e")},8978:function(e,t,i){"use strict";i("560f")},9084:function(e,t,i){},"9e2e":function(e,t,i){"use strict";i("53c2")},b86d:function(e,t,i){"use strict";i("32e8")},c922:function(e,t,i){"use strict";i("9084")},fb4e:function(e,t,i){}}]);
//# sourceMappingURL=chunk-c14455b0.js.map